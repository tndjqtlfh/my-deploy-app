# .github/workflows/deploy.yml
name: Deploy React App to GitHub Pages

# 언제 실행? → main 브랜치에 push할 때마다 자동 실행
on:
  push:
    branches: ['main']
  workflow_dispatch:       # GitHub 웹에서 수동 실행도 가능

# GitHub Pages 배포에 필요한 권한
permissions:
  contents: read
  pages: write
  id-token: write

# 동시에 여러 배포가 겹치지 않도록
concurrency:
  group: 'pages'
  cancel-in-progress: false

jobs:
  # ── 1단계: 빌드 ──
  build:
    runs-on: ubuntu-latest    # GitHub이 제공하는 리눅스 서버에서 실행
    steps:
      - name: Checkout        # 코드 다운로드
        uses: actions/checkout@v5

      - name: Setup Node.js   # Node.js 설치
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies   # 라이브러리 설치
        run: npm ci

      - name: Build                   # React 빌드 → dist/ 생성
        run: npm run build

      - name: Setup Pages
        uses: actions/configure-pages@v5

      - name: Upload artifact         # dist/ 폴더를 업로드
        uses: actions/upload-pages-artifact@v4
        with:
          path: './dist'

  # ── 2단계: 배포 (빌드 성공 후 실행) ──
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build              # build가 성공해야만 실행
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4